<div class="offre-emploi-container">
  <div class="container py-4">
    @if (offreEmploi(); as offreEmploiRef) {
      <div class="card shadow-lg border-0 rounded-lg overflow-hidden">
        <!-- En-tête de la carte avec image de fond -->
        <div class="card-header bg-primary text-white position-relative py-4">
          <div class="overlay-header" style="background-image: url('content/images/employeur.jpg');"></div>
          <div class="position-relative">
            <h1 class="display-5 fw-bold mb-0">{{ offreEmploiRef.titre }}</h1>
            <div class="d-flex flex-wrap align-items-center mt-2 gap-2">
              @if (offreEmploi()!.recruteur) {
                <span class="badge bg-light text-dark px-3 py-2">
                  <fa-icon icon="building" class="me-1"></fa-icon>
                  {{ offreEmploiRef.recruteur?.nomEntreprise || 'Entreprise #' + offreEmploiRef.recruteur?.id }}
                </span>
              }
              @if (offreEmploi()!.typeContrat) {
                <span class="badge bg-light text-dark px-3 py-2">
                  <fa-icon icon="file-contract" class="me-1"></fa-icon>
                  {{ offreEmploiRef.typeContrat?.nom || 'Contrat #' + offreEmploiRef.typeContrat?.id }}
                </span>
              }
              @if (offreEmploi()!.localisation) {
                <span class="badge bg-light text-dark px-3 py-2">
                  <fa-icon icon="map-marker-alt" class="me-1"></fa-icon>
                  {{ offreEmploiRef.localisation?.ville || 'Localisation #' + offreEmploiRef.localisation?.id }}
                  @if (offreEmploiRef.localisation?.region) {
                    <span class="ms-1 text-muted">- {{ offreEmploiRef.localisation?.region }}</span>
                  }
                </span>
              }
            </div>
          </div>
        </div>

        <!-- Corps de la carte -->
        <div class="card-body">
          <div class="row">
            <!-- Colonne principale -->
            <div class="col-lg-8">
              <div class="info-section mb-4">
                <h3 class="section-title"><fa-icon icon="info-circle" class="me-2"></fa-icon>Description</h3>
                <div class="p-3 bg-light rounded">
                  <p class="description-text">{{ offreEmploiRef.description }}</p>
                </div>
              </div>

              @if (offreEmploiRef.competences && offreEmploiRef.competences.length > 0) {
                <div class="info-section mb-4">
                  <h3 class="section-title"><fa-icon icon="briefcase" class="me-2"></fa-icon>Compétences requises</h3>
                  <div class="p-3 bg-light rounded">
                    <div class="d-flex flex-wrap gap-2">
                      @for (competence of offreEmploiRef.competences; track $index) {
                        <span class="badge bg-primary p-2">
                          <fa-icon icon="check-circle" class="me-1"></fa-icon>
                          {{ competence.nom || 'Compétence #' + competence.id }}
                        </span>
                      }
                    </div>
                  </div>
                </div>
              }
            </div>

            <!-- Colonne latérale -->
            <div class="col-lg-4">
              <!-- Informations sur l'entreprise -->
              @if (offreEmploiRef.recruteur) {
                <div class="card border-0 shadow-sm mb-4">
                  <div class="card-header bg-primary text-white">
                    <h3 class="h5 mb-0"><fa-icon icon="building" class="me-2"></fa-icon>Entreprise</h3>
                  </div>
                  <div class="card-body">
                    <h5 class="fw-bold text-primary mb-2">
                      {{ offreEmploiRef.recruteur?.nomEntreprise || 'Entreprise #' + offreEmploiRef.recruteur?.id }}
                    </h5>
                    <p class="text-muted small mb-0">
                      <fa-icon icon="user" class="me-1"></fa-icon>
                      ID Recruteur: {{ offreEmploiRef.recruteur?.id }}
                    </p>
                  </div>
                </div>
              }

              <!-- Détails de l'offre -->
              <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                  <h3 class="h5 mb-0"><fa-icon icon="info-circle" class="me-2"></fa-icon>Détails de l'offre</h3>
                </div>
                <div class="card-body">
                  <ul class="list-group list-group-flush">
                    @if (offreEmploiRef.salaire) {
                      <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                        <span><fa-icon icon="money-bill-wave" class="me-2 text-success"></fa-icon>Salaire</span>
                        <span class="fw-bold text-success">{{ offreEmploiRef.salaire }} €</span>
                      </li>
                    }
                    @if (offreEmploiRef.typeContrat) {
                      <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                        <span><fa-icon icon="file-contract" class="me-2 text-primary"></fa-icon>Type de contrat</span>
                        <span class="fw-bold">{{ offreEmploiRef.typeContrat?.nom || 'Contrat #' + offreEmploiRef.typeContrat?.id }}</span>
                      </li>
                    }
                    @if (offreEmploiRef.localisation) {
                      <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                        <span><fa-icon icon="map-marker-alt" class="me-2 text-info"></fa-icon>Localisation</span>
                        <div class="text-end">
                          <div class="fw-bold">{{ offreEmploiRef.localisation?.ville || 'Ville #' + offreEmploiRef.localisation?.id }}</div>
                          @if (offreEmploiRef.localisation?.region) {
                            <small class="text-muted">{{ offreEmploiRef.localisation?.region }}</small>
                          }
                        </div>
                      </li>
                    }
                    @if (offreEmploiRef.datePublication) {
                      <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                        <span><fa-icon icon="calendar-alt" class="me-2 text-primary"></fa-icon>Publié le</span>
                        <span>{{ offreEmploiRef.datePublication | formatMediumDatetime }}</span>
                      </li>
                    }
                    @if (offreEmploiRef.dateExpiration) {
                      <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                        <span><fa-icon icon="calendar-times" class="me-2 text-danger"></fa-icon>Expire le</span>
                        <span class="text-danger">{{ offreEmploiRef.dateExpiration | formatMediumDatetime }}</span>
                      </li>
                    }
                  </ul>
                </div>
              </div>

              <!-- Boutons d'action -->
              <div class="action-buttons">
                <!-- Bouton pour postuler uniquement pour les candidats -->
                <ng-container *ngIf="hasAnyAuthority('ROLE_CANDIDAT')">
                  <button 
                    type="button" 
                    [routerLink]="['/candidature/postuler']" 
                    [queryParams]="{offre: offreEmploiRef.id}" 
                    class="btn btn-success btn-lg w-100 mb-3 d-flex align-items-center justify-content-center">
                    <fa-icon icon="paper-plane" class="me-2"></fa-icon>
                    <span>Postuler maintenant</span>
                  </button>
                </ng-container>

                <!-- Bouton d'édition visible uniquement pour les non-candidats -->
                <ng-container *ngIf="!hasAnyAuthority('ROLE_CANDIDAT')">
                  <button 
                    type="button" 
                    [routerLink]="['/offre-emploi', offreEmploiRef.id, 'edit']" 
                    class="btn btn-primary btn-lg w-100 mb-3 d-flex align-items-center justify-content-center">
                    <fa-icon icon="pencil-alt" class="me-2"></fa-icon>
                    <span>Modifier cette offre</span>
                  </button>
                </ng-container>

                <button 
                  type="submit" 
                  (click)="previousState()" 
                  class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center">
                  <fa-icon icon="arrow-left" class="me-2"></fa-icon>
                  <span>Retour</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>

<style>
  .offre-emploi-container {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    min-height: 100vh;
    padding: 20px 0;
  }
  
  .overlay-header {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-size: cover;
    background-position: center;
    opacity: 0.15;
    border-radius: 0.5rem 0.5rem 0 0;
  }
  
  .section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #343a40;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 3px solid #007bff;
    display: flex;
    align-items: center;
  }
  
  .description-text {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #495057;
    text-align: justify;
  }
  
  .info-section {
    margin-bottom: 2rem;
  }
  
  .action-buttons {
    margin-top: 1.5rem;
  }
  
  .card {
    border-radius: 0.75rem;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1) !important;
  }
  
  .card-header {
    border-bottom: none;
    border-radius: 0.75rem 0.75rem 0 0 !important;
  }
  
  .badge {
    font-size: 0.9rem;
    font-weight: 500;
    border-radius: 50rem;
    transition: all 0.2s ease;
  }
  
  .badge:hover {
    transform: scale(1.05);
  }
  
  .list-group-item {
    transition: background-color 0.2s ease;
  }
  
  .list-group-item:hover {
    background-color: #f8f9fa !important;
  }
  
  .btn {
    border-radius: 0.5rem;
    font-weight: 500;
    transition: all 0.3s ease;
  }
  
  .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  
  .display-5 {
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }
</style>
