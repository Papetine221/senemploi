<div class="mes-candidatures-container">
  <!-- En-tête moderne -->
  <div class="candidatures-header">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="display-5 fw-bold text-primary mb-2">
            <fa-icon icon="file-alt" class="me-3"></fa-icon>
            Mes Candidatures
          </h1>
          <p class="lead text-muted mb-0">
            Suivez l'état de vos candidatures et consultez les détails de vos postulations
          </p>
        </div>
        <div class="col-md-4 text-end">
          <button class="btn btn-outline-primary" (click)="load()" [disabled]="isLoading">
            <fa-icon icon="sync" [animation]="isLoading ? 'spin' : undefined" class="me-2"></fa-icon>
            Actualiser
          </button>
        </div>
      </div>
    </div>
  </div>

  <jhi-alert-error />
  <jhi-alert />

  <div class="container-fluid py-4">

    @if (isLoading) {
      <div class="text-center py-5">
        <fa-icon icon="spinner" animation="spin" size="3x" class="text-primary"></fa-icon>
        <p class="mt-3 text-muted">Chargement de vos candidatures...</p>
      </div>
    } @else if (candidatures().length === 0) {
      <div class="empty-state">
        <div class="empty-state-icon">
          <fa-icon icon="inbox" size="5x" class="text-muted"></fa-icon>
        </div>
        <h3 class="empty-state-title">Aucune candidature</h3>
        <p class="empty-state-text">
          Vous n'avez pas encore postulé à des offres d'emploi.
          <br>
          Explorez nos offres et postulez dès maintenant !
        </p>
        <a [routerLink]="['/offre-emploi']" class="btn btn-primary btn-lg mt-3">
          <fa-icon icon="search" class="me-2"></fa-icon>
          Rechercher des offres
        </a>
      </div>
    } @else {
      <!-- Statistiques -->
      <div class="row mb-4">
        <div class="col-md-3 mb-3">
          <div class="stat-card stat-total">
            <div class="stat-icon">
              <fa-icon icon="file-alt" size="2x"></fa-icon>
            </div>
            <div class="stat-content">
              <h3 class="stat-number">{{ candidatures().length }}</h3>
              <p class="stat-label">Total</p>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="stat-card stat-pending">
            <div class="stat-icon">
              <fa-icon icon="clock" size="2x"></fa-icon>
            </div>
            <div class="stat-content">
              <h3 class="stat-number">{{ getCountByStatus('EN_ATTENTE') }}</h3>
              <p class="stat-label">En attente</p>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="stat-card stat-accepted">
            <div class="stat-icon">
              <fa-icon icon="check-circle" size="2x"></fa-icon>
            </div>
            <div class="stat-content">
              <h3 class="stat-number">{{ getCountByStatus('ACCEPTEE') }}</h3>
              <p class="stat-label">Acceptées</p>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="stat-card stat-rejected">
            <div class="stat-icon">
              <fa-icon icon="times-circle" size="2x"></fa-icon>
            </div>
            <div class="stat-content">
              <h3 class="stat-number">{{ getCountByStatus('REFUSEE') }}</h3>
              <p class="stat-label">Refusées</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Liste des candidatures en cartes -->
      <div class="row">
        @for (candidature of candidatures(); track trackId(candidature)) {
          <div class="col-lg-6 mb-4">
            <div class="candidature-card" [class.status-pending]="candidature.statut === 'EN_ATTENTE'"
                 [class.status-accepted]="candidature.statut === 'ACCEPTEE'"
                 [class.status-rejected]="candidature.statut === 'REFUSEE'">
              
              <!-- En-tête de la carte -->
              <div class="candidature-header">
                <div class="candidature-title-section">
                  <h4 class="candidature-title">
                    <fa-icon icon="briefcase" class="me-2"></fa-icon>
                    {{ candidature.offre?.titre || 'Offre #' + candidature.offre?.id }}
                  </h4>
                  <p class="candidature-company mb-0">
                    <fa-icon icon="building" class="me-1"></fa-icon>
                    {{ candidature.offre?.recruteur?.nomEntreprise || 'Entreprise' }}
                  </p>
                </div>
                <div class="candidature-status">
                  @if (candidature.statut === 'EN_ATTENTE') {
                    <span class="badge badge-pending">
                      <fa-icon icon="clock" class="me-1"></fa-icon>
                      En attente
                    </span>
                  } @else if (candidature.statut === 'ACCEPTEE') {
                    <span class="badge badge-accepted">
                      <fa-icon icon="check-circle" class="me-1"></fa-icon>
                      Acceptée
                    </span>
                  } @else if (candidature.statut === 'REFUSEE') {
                    <span class="badge badge-rejected">
                      <fa-icon icon="times-circle" class="me-1"></fa-icon>
                      Refusée
                    </span>
                  }
                </div>
              </div>

              <!-- Corps de la carte -->
              <div class="candidature-body">
                <div class="candidature-info">
                  <div class="info-item">
                    <fa-icon icon="calendar" class="info-icon"></fa-icon>
                    <div class="info-content">
                      <span class="info-label">Date de postulation</span>
                      <span class="info-value">{{ candidature.datePostulation | formatMediumDatetime }}</span>
                    </div>
                  </div>
                  
                  @if (candidature.offre?.localisation) {
                    <div class="info-item">
                      <fa-icon icon="map-marker-alt" class="info-icon"></fa-icon>
                      <div class="info-content">
                        <span class="info-label">Localisation</span>
                        <span class="info-value">{{ candidature.offre?.localisation?.ville }}</span>
                      </div>
                    </div>
                  }
                  
                  @if (candidature.offre?.typeContrat) {
                    <div class="info-item">
                      <fa-icon icon="file-contract" class="info-icon"></fa-icon>
                      <div class="info-content">
                        <span class="info-label">Type de contrat</span>
                        <span class="info-value">{{ candidature.offre?.typeContrat?.nom }}</span>
                      </div>
                    </div>
                  }
                </div>

                <!-- Lettre de motivation (extrait) -->
                @if (candidature.lettreMotivation) {
                  <div class="candidature-motivation">
                    <h6 class="motivation-title">
                      <fa-icon icon="file-alt" class="me-2"></fa-icon>
                      Lettre de motivation
                    </h6>
                    <p class="motivation-text">
                      {{ candidature.lettreMotivation.length > 150 ? (candidature.lettreMotivation | slice:0:150) + '...' : candidature.lettreMotivation }}
                    </p>
                  </div>
                }
              </div>

              <!-- Actions -->
              <div class="candidature-actions">
                <a [routerLink]="['/offre-emploi', candidature.offre?.id, 'view']" class="btn btn-outline-primary btn-sm">
                  <fa-icon icon="eye" class="me-1"></fa-icon>
                  Voir l'offre
                </a>
                <a [routerLink]="['/candidature', candidature.id, 'view']" class="btn btn-primary btn-sm">
                  <fa-icon icon="info-circle" class="me-1"></fa-icon>
                  Détails
                </a>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
