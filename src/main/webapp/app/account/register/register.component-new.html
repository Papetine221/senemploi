<div class="register-container">
  <div class="container-fluid">
    <div class="row min-vh-100">
      <!-- Section formulaire -->
      <div class="col-12">
        <div class="register-wrapper">
          <!-- Header -->
          <div class="register-header text-center mb-4">
            <div class="logo-section mb-3">
              <h1 class="brand-title">Senemploi</h1>
            </div>
            <h2 class="register-title" data-cy="registerTitle">Créez votre compte</h2>
            <p class="register-subtitle">Rejoignez notre plateforme et découvrez de nouvelles opportunités</p>
            
            <!-- Type selector -->
            <div class="user-type-selector mb-4">
              <a 
                class="type-btn" 
                [class.active]="userType === 'candidat'" 
                [routerLink]="['/account/register']" 
                [queryParams]="{ type: 'candidat' }">
                <i class="fas fa-user-tie"></i>
                <span>Je cherche un emploi</span>
              </a>
              <a 
                class="type-btn" 
                [class.active]="userType === 'recruteur'"
                [routerLink]="['/account/register']" 
                [queryParams]="{ type: 'recruteur' }">
                <i class="fas fa-building"></i>
                <span>Je recrute</span>
              </a>
            </div>
          </div>

          <!-- Messages d'alerte -->
          @if (success()) {
            <div class="alert alert-success alert-modern mb-4">
              <i class="fas fa-check-circle me-2"></i>
              <div>
                <strong>Inscription réussie !</strong>
                <p class="mb-0">Votre compte a été créé. Veuillez vérifier votre email pour l'activer.</p>
              </div>
            </div>
          }

          @if (error()) {
            <div class="alert alert-danger alert-modern mb-4">
              <i class="fas fa-exclamation-circle me-2"></i>
              <div>
                <strong>Erreur d'inscription</strong>
                <p class="mb-0">Une erreur s'est produite. Veuillez réessayer plus tard.</p>
              </div>
            </div>
          }

          @if (errorUserExists()) {
            <div class="alert alert-danger alert-modern mb-4">
              <i class="fas fa-user-times me-2"></i>
              <div>
                <strong>Nom d'utilisateur déjà pris</strong>
                <p class="mb-0">Ce nom d'utilisateur existe déjà. Veuillez en choisir un autre.</p>
              </div>
            </div>
          }

          @if (errorEmailExists()) {
            <div class="alert alert-danger alert-modern mb-4">
              <i class="fas fa-envelope-open-text me-2"></i>
              <div>
                <strong>Email déjà utilisé</strong>
                <p class="mb-0">Cet email est déjà enregistré. Essayez de vous connecter ou utilisez un autre email.</p>
              </div>
            </div>
          }

          @if (doNotMatch()) {
            <div class="alert alert-danger alert-modern mb-4">
              <i class="fas fa-key me-2"></i>
              <div>
                <strong>Mots de passe différents</strong>
                <p class="mb-0">Les deux mots de passe ne correspondent pas.</p>
              </div>
            </div>
          }

          <!-- Formulaire principal -->
          @if (!success()) {
            <form name="form" class="register-form" (ngSubmit)="register()" [formGroup]="registerForm">
              <div class="row g-4">
                <!-- Informations générales -->
                <div class="col-12">
                  <h5 class="section-title"><i class="fas fa-user-circle me-2"></i>Informations générales</h5>
                </div>

                <!-- Nom d'utilisateur -->
                <div class="col-md-6">
                  <label class="form-label" for="login">
                    <i class="fas fa-user me-2"></i>Nom d'utilisateur *
                  </label>
                  <input
                    type="text"
                    class="form-control modern-input"
                    id="login"
                    #login
                    name="login"
                    placeholder="Choisissez un nom d'utilisateur"
                    formControlName="login"
                    data-cy="username"
                  />
                  @let loginRef = registerForm.get('login')!;
                  @if (loginRef.invalid && (loginRef.dirty || loginRef.touched)) {
                    <div class="form-error">
                      @if (loginRef?.errors?.required) {
                        <small><i class="fas fa-exclamation-circle me-1"></i>Le nom d'utilisateur est obligatoire.</small>
                      }
                      @if (loginRef?.errors?.minlength) {
                        <small><i class="fas fa-exclamation-circle me-1"></i>Minimum 1 caractère.</small>
                      }
                      @if (loginRef?.errors?.maxlength) {
                        <small><i class="fas fa-exclamation-circle me-1"></i>Maximum 50 caractères.</small>
                      }
                      @if (loginRef?.errors?.pattern) {
                        <small><i class="fas fa-exclamation-circle me-1"></i>Format invalide.</small>
                      }
                    </div>
                  }
                </div>

                <!-- Email -->
                <div class="col-md-6">
                  <label class="form-label" for="email">
                    <i class="fas fa-envelope me-2"></i>Email *
                  </label>
                  <input
                    type="email"
                    class="form-control modern-input"
                    id="email"
                    name="email"
                    placeholder="votre@email.com"
                    formControlName="email"
                    data-cy="email"
                  />
                  @let emailRef = registerForm.get('email')!;
                  @if (emailRef.invalid && (emailRef.dirty || emailRef.touched)) {
                    <div class="form-error">
                      @if (emailRef?.errors?.required) {
                        <small><i class="fas fa-exclamation-circle me-1"></i>L'email est obligatoire.</small>
                      }
                      @if (emailRef?.errors?.email) {
                        <small><i class="fas fa-exclamation-circle me-1"></i>Format d'email invalide.</small>
                      }
                    </div>
                  }
                </div>

                <!-- Mot de passe -->
                <div class="col-md-6">
                  <label class="form-label" for="password">
                    <i class="fas fa-lock me-2"></i>Mot de passe *
                  </label>
                  <input
                    type="password"
                    class="form-control modern-input"
                    id="password"
                    name="password"
                    placeholder="Entrez votre mot de passe"
                    formControlName="password"
                    data-cy="firstPassword"
                  />
                  @let passwordRef = registerForm.get('password')!;
                  @if (passwordRef.invalid && (passwordRef.dirty || passwordRef.touched)) {
                    <div class="form-error">
                      @if (passwordRef?.errors?.required) {
                        <small><i class="fas fa-exclamation-circle me-1"></i>Le mot de passe est obligatoire.</small>
                      }
                      @if (passwordRef?.errors?.minlength) {
                        <small><i class="fas fa-exclamation-circle me-1"></i>Minimum 4 caractères.</small>
                      }
                    </div>
                  }
                  <jhi-password-strength-bar [passwordToCheck]="passwordRef.value" />
                </div>

                <!-- Confirmation mot de passe -->
                <div class="col-md-6">
                  <label class="form-label" for="confirmPassword">
                    <i class="fas fa-lock me-2"></i>Confirmer le mot de passe *
                  </label>
                  <input
                    type="password"
                    class="form-control modern-input"
                    id="confirmPassword"
                    name="confirmPassword"
                    placeholder="Confirmez votre mot de passe"
                    formControlName="confirmPassword"
                    data-cy="secondPassword"
                  />
                  @let confirmPasswordRef = registerForm.get('confirmPassword')!;
                  @if (confirmPasswordRef.invalid && (confirmPasswordRef.dirty || confirmPasswordRef.touched)) {
                    <div class="form-error">
                      @if (confirmPasswordRef?.errors?.required) {
                        <small><i class="fas fa-exclamation-circle me-1"></i>La confirmation est obligatoire.</small>
                      }
                    </div>
                  }
                </div>

                <!-- Champs spécifiques Candidat -->
                @if (userType === 'candidat') {
                  <div class="col-12 mt-4">
                    <h5 class="section-title"><i class="fas fa-id-card me-2"></i>Informations candidat</h5>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label" for="telephone">
                      <i class="fas fa-phone me-2"></i>Téléphone
                    </label>
                    <input 
                      type="tel" 
                      class="form-control modern-input" 
                      id="telephone" 
                      name="telephone" 
                      placeholder="+221 77 123 45 67"
                      formControlName="telephone" 
                    />
                  </div>

                  <div class="col-md-6">
                    <label class="form-label" for="adresse">
                      <i class="fas fa-map-marker-alt me-2"></i>Adresse
                    </label>
                    <input 
                      type="text" 
                      class="form-control modern-input" 
                      id="adresse" 
                      name="adresse"
                      placeholder="Votre adresse complète" 
                      formControlName="adresse" 
                    />
                  </div>

                  <div class="col-12">
                    <label class="form-label" for="cv">
                      <i class="fas fa-file-upload me-2"></i>CV (optionnel)
                    </label>
                    <input 
                      type="file" 
                      class="form-control modern-input file-input" 
                      id="cv" 
                      name="cv" 
                      accept=".pdf,.doc,.docx"
                      (change)="onFileChange($event)" 
                    />
                    <small class="form-text text-muted">
                      <i class="fas fa-info-circle me-1"></i>Formats acceptés : PDF, DOC, DOCX (Max 5 MB)
                    </small>
                  </div>
                }

                <!-- Champs spécifiques Recruteur -->
                @if (userType === 'recruteur') {
                  <div class="col-12 mt-4">
                    <h5 class="section-title"><i class="fas fa-briefcase me-2"></i>Informations entreprise</h5>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label" for="nomEntreprise">
                      <i class="fas fa-building me-2"></i>Nom de l'entreprise
                    </label>
                    <input 
                      type="text" 
                      class="form-control modern-input" 
                      id="nomEntreprise" 
                      name="nomEntreprise"
                      placeholder="Nom de votre entreprise" 
                      formControlName="nomEntreprise" 
                    />
                  </div>

                  <div class="col-md-6">
                    <label class="form-label" for="secteur">
                      <i class="fas fa-industry me-2"></i>Secteur d'activité
                    </label>
                    <input 
                      type="text" 
                      class="form-control modern-input" 
                      id="secteur" 
                      name="secteur"
                      placeholder="Informatique, Finance, etc." 
                      formControlName="secteur" 
                    />
                  </div>
                }

                <!-- Bouton de soumission -->
                <div class="col-12 mt-4">
                  <button 
                    data-cy="submit" 
                    type="submit" 
                    class="btn btn-primary btn-modern w-100" 
                    [disabled]="registerForm.invalid || !userType"
                  >
                    @if (registerForm.invalid || !userType) {
                      <i class="fas fa-lock me-2"></i>Veuillez remplir tous les champs requis
                    } @else {
                      <i class="fas fa-user-plus me-2"></i>Créer mon compte
                    }
                  </button>
                </div>
              </div>
            </form>
          }

          <!-- Lien vers connexion -->
          <div class="login-link text-center mt-4">
            <p class="mb-0">
              Vous avez déjà un compte ? 
              <a routerLink="/login" class="link-primary">
                <i class="fas fa-sign-in-alt me-1"></i>Connectez-vous
              </a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
