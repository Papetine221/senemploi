# ğŸ‘ï¸ AperÃ§u du CV en miniature - Documentation

## âœ… FonctionnalitÃ© ajoutÃ©e

Le systÃ¨me de candidature inclut maintenant **l'affichage du CV en miniature (preview)** directement dans le formulaire de postulation.

---

## ğŸ¯ Objectif

Permettre au candidat de **visualiser son CV** avant d'envoyer sa candidature pour :
- âœ… VÃ©rifier que le bon fichier est sÃ©lectionnÃ©
- âœ… S'assurer que le CV est lisible
- âœ… Voir un aperÃ§u rapide sans tÃ©lÃ©charger
- âœ… AmÃ©liorer l'expÃ©rience utilisateur

---

## ğŸ–¼ï¸ Interface utilisateur

### **1. CV existant avec bouton "AperÃ§u"**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… CV actuel : application/pdf (245.67 KB)        â”‚
â”‚                                                    â”‚
â”‚  [ğŸ‘ï¸ AperÃ§u] [ğŸ“¥ TÃ©lÃ©charger] [ğŸ”„ Remplacer]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. Miniature du CV (PDF)**

Quand le candidat clique sur "AperÃ§u" :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” AperÃ§u du CV                              [âœ•]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                                          â”‚     â”‚
â”‚  â”‚         [Contenu du PDF affichÃ©]         â”‚     â”‚
â”‚  â”‚                                          â”‚     â”‚
â”‚  â”‚         dans un iframe de 600px          â”‚     â”‚
â”‚  â”‚                                          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. Miniature du CV (Word DOC/DOCX)**

Pour les documents Word (non visualisables directement) :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” AperÃ§u du CV                              [âœ•]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚                    ğŸ“„ (icÃ´ne Word)                 â”‚
â”‚                                                    â”‚
â”‚                  CV_candidat.docx                  â”‚
â”‚                                                    â”‚
â”‚      Cliquez sur "TÃ©lÃ©charger" pour voir          â”‚
â”‚               le contenu complet                   â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **4. Nouveau CV avec aperÃ§u**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ Nouveau CV : Mon_CV_2024.pdf (312.45 KB)       â”‚
â”‚                                                    â”‚
â”‚              [ğŸ‘ï¸ AperÃ§u] [âŒ Annuler]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” AperÃ§u du nouveau CV                      [âœ•]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚        [Preview du nouveau fichier PDF]            â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ Architecture technique

### **HTML Template**

**Bouton AperÃ§u** :
```html
<button 
  type="button" 
  class="btn btn-sm btn-outline-info"
  (click)="previewCv()">
  <fa-icon icon="eye"></fa-icon>
  AperÃ§u
</button>
```

**Container de preview** :
```html
@if (showCvPreview) {
  <div class="cv-preview-container">
    <div class="cv-preview-header">
      <h6>
        <fa-icon icon="search"></fa-icon>
        AperÃ§u du CV
      </h6>
      <button (click)="showCvPreview = false">
        <fa-icon icon="times"></fa-icon>
      </button>
    </div>
    
    <div class="cv-thumbnail">
      @if (isPdfCv(candidat.cvContentType)) {
        <iframe 
          [src]="getCvPreviewUrl()" 
          class="cv-iframe">
        </iframe>
      } @else {
        <div class="cv-doc-preview">
          <fa-icon icon="file-word" size="5x"></fa-icon>
          <h5>{{ getFileName() }}</h5>
          <p>Document Word - TÃ©lÃ©chargez pour voir le contenu</p>
        </div>
      }
    </div>
  </div>
}
```

### **TypeScript Component**

**Variables** :
```typescript
showCvPreview = false;           // Afficher preview CV existant
showNewCvPreview = false;        // Afficher preview nouveau CV
newCvPreviewUrl: any = null;     // URL du nouveau CV
```

**MÃ©thode pour afficher le CV existant** :
```typescript
previewCv(): void {
  this.showCvPreview = !this.showCvPreview;
  this.showNewCvPreview = false;  // Fermer l'autre preview
}
```

**MÃ©thode pour afficher le nouveau CV** :
```typescript
previewNewCv(): void {
  if (this.newCvFile) {
    const reader = new FileReader();
    reader.onload = (e: any) => {
      // Sanitize l'URL pour la sÃ©curitÃ©
      this.newCvPreviewUrl = this.sanitizer.bypassSecurityTrustResourceUrl(e.target.result);
      this.showNewCvPreview = true;
      this.showCvPreview = false;
    };
    reader.readAsDataURL(this.newCvFile);
  }
}
```

**GÃ©nÃ©rer l'URL du CV existant** :
```typescript
getCvPreviewUrl(): SafeResourceUrl | null {
  if (this.candidat?.cv && this.candidat?.cvContentType) {
    // Convertir Base64 â†’ Blob â†’ URL
    const byteCharacters = atob(this.candidat.cv);
    const byteNumbers = new Array(byteCharacters.length);
    
    for (let i = 0; i < byteCharacters.length; i++) {
      byteNumbers[i] = byteCharacters.charCodeAt(i);
    }
    
    const byteArray = new Uint8Array(byteNumbers);
    const blob = new Blob([byteArray], { type: this.candidat.cvContentType });
    const url = URL.createObjectURL(blob);
    
    // Sanitize pour Angular
    return this.sanitizer.bypassSecurityTrustResourceUrl(url);
  }
  return null;
}
```

**VÃ©rifier si PDF** :
```typescript
isPdfCv(contentType: string | undefined): boolean {
  return contentType === 'application/pdf';
}
```

**Nom du fichier** :
```typescript
getFileName(): string {
  if (this.candidat?.id) {
    return `CV_${this.candidat.id}.${this.getFileExtension(this.candidat.cvContentType || '')}`;
  }
  return 'CV.pdf';
}
```

---

## ğŸ¨ Styles CSS

### **Container de preview**

```scss
.cv-preview-container {
  border: 2px solid #e9ecef;
  border-radius: 0.5rem;
  padding: 1rem;
  background: #ffffff;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);

  .cv-preview-header {
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #dee2e6;
    margin-bottom: 1rem;

    h6 {
      font-weight: 600;
      color: #495057;
    }
  }

  .cv-thumbnail {
    width: 100%;
    min-height: 400px;
    background: #f8f9fa;
    border-radius: 0.375rem;
    overflow: hidden;

    .cv-iframe {
      width: 100%;
      height: 600px;
      border: none;
      background: white;
    }

    .cv-doc-preview {
      background: linear-gradient(135deg, #f8f9fa, #ffffff);
      border: 2px dashed #dee2e6;
      border-radius: 0.375rem;
      padding: 3rem;
      text-align: center;

      fa-icon {
        opacity: 0.7;
        transition: all 0.3s ease;
      }

      &:hover fa-icon {
        opacity: 1;
        transform: scale(1.05);
      }
    }
  }
}
```

### **Bouton AperÃ§u**

```scss
.btn-outline-info {
  border: 2px solid #17a2b8;
  color: #17a2b8;

  &:hover {
    background: #17a2b8;
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
  }
}
```

---

## ğŸ”’ SÃ©curitÃ©

### **Sanitization avec DomSanitizer**

Angular bloque par dÃ©faut les URL non sÃ»res. On utilise `DomSanitizer` pour contourner cette protection de maniÃ¨re sÃ©curisÃ©e :

```typescript
import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';

// Injection
protected sanitizer = inject(DomSanitizer);

// Utilisation
return this.sanitizer.bypassSecurityTrustResourceUrl(url);
```

**Pourquoi ?**
- âœ… Les URL `blob:` et `data:` sont considÃ©rÃ©es comme non sÃ»res
- âœ… `bypassSecurityTrustResourceUrl()` indique Ã  Angular que l'URL est sÃ»re
- âœ… Fonctionne uniquement avec les types `SafeResourceUrl`
- âœ… Ne compromet pas la sÃ©curitÃ© car les donnÃ©es viennent de la base de donnÃ©es

---

## ğŸ“Š Formats supportÃ©s

| Format | Preview | Affichage |
|--------|---------|-----------|
| **PDF** | âœ… Oui | Iframe avec contenu complet |
| **DOC** | âŒ Non | IcÃ´ne Word + Message |
| **DOCX** | âŒ Non | IcÃ´ne Word + Message |

**Pourquoi les documents Word ne sont pas prÃ©visualisÃ©s ?**
- âŒ Les navigateurs ne peuvent pas afficher les `.doc` / `.docx` nativement
- âŒ NÃ©cessiterait une conversion serveur (Word â†’ PDF ou HTML)
- âœ… On affiche une icÃ´ne avec un message explicatif

---

## ğŸ”„ Flux utilisateur

### **ScÃ©nario 1 : CV existant (PDF)**

```
1. Candidat voit le badge "CV actuel"
   â†“
2. Clique sur "AperÃ§u"
   â†“
3. Miniature s'affiche avec le PDF
   â†“
4. Candidat peut :
   - Fermer avec [âœ•]
   - TÃ©lÃ©charger
   - Remplacer le CV
```

### **ScÃ©nario 2 : CV existant (Word)**

```
1. Candidat voit le badge "CV actuel"
   â†“
2. Clique sur "AperÃ§u"
   â†“
3. Message s'affiche : "Document Word"
   â†“
4. Candidat doit tÃ©lÃ©charger pour voir le contenu
```

### **ScÃ©nario 3 : Nouveau CV (PDF)**

```
1. Candidat sÃ©lectionne un nouveau fichier PDF
   â†“
2. Badge bleu "Nouveau CV" apparaÃ®t
   â†“
3. Clique sur "AperÃ§u"
   â†“
4. Preview du nouveau fichier s'affiche
   â†“
5. Candidat peut :
   - Fermer avec [âœ•]
   - Annuler la sÃ©lection
   - Envoyer la candidature
```

### **ScÃ©nario 4 : Changement entre previews**

```
1. Candidat a un CV existant et sÃ©lectionne un nouveau
   â†“
2. AperÃ§u du CV existant ouvert
   â†“
3. Clique sur "AperÃ§u" du nouveau CV
   â†“
4. âœ… Preview du CV existant se ferme automatiquement
5. âœ… Preview du nouveau CV s'ouvre
```

---

## ğŸ§ª Tests de la fonctionnalitÃ©

### **Test 1 : AperÃ§u CV existant (PDF)**
1. âœ… Candidat avec CV PDF uploadÃ©
2. âœ… Aller sur `/candidature/postuler?offre=123`
3. âœ… Cliquer sur "AperÃ§u"
4. âœ… **VÃ©rifier** : Miniature affichÃ©e avec iframe
5. âœ… **VÃ©rifier** : Contenu du PDF visible
6. âœ… **VÃ©rifier** : Hauteur 600px
7. âœ… Cliquer sur [âœ•]
8. âœ… **VÃ©rifier** : Preview se ferme

### **Test 2 : AperÃ§u CV existant (Word)**
1. âœ… Candidat avec CV Word uploadÃ©
2. âœ… Cliquer sur "AperÃ§u"
3. âœ… **VÃ©rifier** : IcÃ´ne Word affichÃ©e
4. âœ… **VÃ©rifier** : Message "TÃ©lÃ©chargez pour voir"
5. âœ… **VÃ©rifier** : Pas d'iframe

### **Test 3 : AperÃ§u nouveau CV (PDF)**
1. âœ… SÃ©lectionner un nouveau fichier PDF
2. âœ… Cliquer sur "AperÃ§u" du nouveau CV
3. âœ… **VÃ©rifier** : Preview s'affiche
4. âœ… **VÃ©rifier** : Contenu visible dans iframe
5. âœ… Cliquer sur "Annuler"
6. âœ… **VÃ©rifier** : Preview se ferme

### **Test 4 : Bascule entre previews**
1. âœ… CV existant (PDF) avec preview ouvert
2. âœ… SÃ©lectionner un nouveau CV
3. âœ… Cliquer sur "AperÃ§u" du nouveau
4. âœ… **VÃ©rifier** : Preview du CV existant fermÃ©
5. âœ… **VÃ©rifier** : Preview du nouveau ouvert
6. âœ… Revenir Ã  l'aperÃ§u du CV existant
7. âœ… **VÃ©rifier** : Preview du nouveau fermÃ©

### **Test 5 : Suppression avec preview ouvert**
1. âœ… Nouveau CV avec preview ouvert
2. âœ… Cliquer sur "Annuler"
3. âœ… **VÃ©rifier** : Preview fermÃ©
4. âœ… **VÃ©rifier** : Fichier supprimÃ©

### **Test 6 : Responsive mobile**
1. âœ… Ouvrir sur mobile
2. âœ… Cliquer sur "AperÃ§u"
3. âœ… **VÃ©rifier** : Preview s'adapte Ã  la largeur
4. âœ… **VÃ©rifier** : Iframe scrollable

---

## ğŸ’¡ Avantages

### **Pour le candidat** ğŸ‘¤
- âœ… **Visualisation rapide** : Voir le CV sans tÃ©lÃ©charger
- âœ… **VÃ©rification** : S'assurer d'avoir le bon fichier
- âœ… **Confiance** : ContrÃ´le avant l'envoi
- âœ… **Gain de temps** : Pas besoin d'ouvrir un autre onglet

### **Pour l'UX** ğŸ¨
- âœ… **Interface moderne** : Preview intÃ©grÃ©
- âœ… **Feedback visuel** : Voir ce qui sera envoyÃ©
- âœ… **Transparence** : Aucune surprise
- âœ… **Professionnalisme** : Application soignÃ©e

### **Pour la sÃ©curitÃ©** ğŸ”’
- âœ… **Validation visuelle** : Le candidat voit son CV
- âœ… **PrÃ©vention d'erreurs** : DÃ©tection de mauvais fichier
- âœ… **Sanitization** : URL sÃ©curisÃ©es avec DomSanitizer

---

## ğŸš€ AmÃ©liorations futures

### **Preview avancÃ©**
- ğŸ“„ **Conversion Word â†’ PDF** cÃ´tÃ© serveur
- ğŸ–¼ï¸ **Thumbnails** pour toutes les pages
- ğŸ” **Zoom** dans le preview
- ğŸ“± **Fullscreen** pour mobile

### **Annotations**
- âœï¸ **Surligner** des sections
- ğŸ’¬ **Commentaires** avant envoi
- ğŸ”– **Marque-pages** dans le CV

### **Comparaison**
- ğŸ“Š **Comparer** deux versions de CV
- ğŸ“ˆ **Historique** des modifications
- ğŸ¯ **Suggestions** d'amÃ©lioration

---

## âœ… RÃ©sultat final

**Le systÃ¨me de candidature inclut maintenant l'aperÃ§u du CV en miniature !**

Les candidats peuvent :
- âœ… **Voir leur CV** directement dans le formulaire
- âœ… **VÃ©rifier le contenu** avant l'envoi
- âœ… **PrÃ©visualiser les PDF** en haute qualitÃ©
- âœ… **Basculer** entre CV existant et nouveau
- âœ… **Fermer/ouvrir** le preview facilement
- âœ… **Interface responsive** sur tous les appareils
- âœ… **SÃ©curitÃ© garantie** avec DomSanitizer

**ExpÃ©rience utilisateur premium et professionnelle !** ğŸ‰
